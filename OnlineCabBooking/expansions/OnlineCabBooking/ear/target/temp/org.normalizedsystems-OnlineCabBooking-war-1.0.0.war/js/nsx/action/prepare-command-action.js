define(["require","exports","jquery","knockout","nsx/triggers","nsx/nsx-actions","nsx/nsx-struts-helper"],(function(e,r,n,t,s,o,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.definePrepareCommandAction=void 0,r.definePrepareCommandAction=function(e,r){r=r||{};var i=function(e){return(0,o.getElementAction)(e.element,"prepare-command-json")}(e),c=t.observable(!1),u=t.observable({}),g=t.observable(!1),d=t.observableArray([]),l=t.observable(),f=t.observable({}),m=s.defineTrigger(),v=s.defineTrigger(),b=s.defineTrigger();function p(){u({}),g(!1),d([]),l()}function E(e){g(e.success),e.success?function(e){var r;p(),u(e.value),d(null!==(r=e.messages)&&void 0!==r?r:[]),v.trigger()}(e):function(e){p(),l(e.errorMessage),e.fieldErrors?f(function(e){var r={};e&&e.forEach((function(e){r[e.qualifiedFieldName]=e.message}));return r}(e.fieldErrors)):f({});b.trigger()}(e),c(!1),m.trigger()}return e.trigger.subscribe((function(){if(!c()){c(!0);var s=t.toJS(e.data);(null==r?void 0:r.target)&&(s.target=t.toJS(r.target)),n.ajax({url:i,data:(0,a.toStrutsObject)({commandName:e.commandName,command:s})}).then(E)}})),{busy:c,result:u,success:g,messages:d,errorMessage:l,completeEvent:m,successEvent:v,errorEvent:b,fieldErrorMap:f}}}));