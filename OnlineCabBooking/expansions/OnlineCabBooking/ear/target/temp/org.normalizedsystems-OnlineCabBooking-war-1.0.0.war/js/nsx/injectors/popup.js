define(["require","exports","nsx/util/utils","nsx/nsx-dialog","knockout","jquery","nsx/error/error-view","nsx/error/error-levels","nsx/error/error-handler-priorities","nsx/injectors/injector","nsx/injectors/id-generator"],(function(e,o,r,n,i,s,t,l,u,c,p){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.closeAllPopups=o.hasVisiblePopups=o.numberOfPopups=o.definePopup=void 0;var a="nsx/knockout/errorMessages";o.definePopup=function(o,f){f=f||{};var d=o.view,g=o.viewModel,v=o.title,b=void 0,m=void 0,x=i.observable(!1),D=!r.isDefined(f.closeOn),w=t.defineErrorView({level:l.error,priority:u.popup-1e-4*n.numberOfDialogs()},{active:x});if(r.isDefined(f.onConfirm)){var P=f.onConfirm;b=function(){return P.trigger(),D}}function O(){m=void 0,x(!1)}return o.trigger.subscribe((function(){x()||e(["text!html/nsx/knockout/popup-wrapper.html"],(function(e){var o;x(!0),(m=n.popupDialog(e,(o=i.unwrap(d),w.clear.trigger(),{title:v,size:f.size,errorView:a,errorModel:w,contentView:o,contentModel:g,confirm:b}))).onHide(O),f.onCancel&&m.onCancel(f.onCancel.trigger)}))})),r.isDefined(f.closeOn)&&f.closeOn.subscribe((function(){if(r.isDefined(m))try{m.close()}catch(e){console.log("dialog already closed")}})),new c.Injector({segment:s(".nsx-dialog-body"),domain:p.defineDomain({name:"popup"})})},o.numberOfPopups=function(){return n.numberOfDialogs()},o.closeAllPopups=function(){return n.closeAllDialogs()},o.hasVisiblePopups=function(){return n.hasDialogs()}}));