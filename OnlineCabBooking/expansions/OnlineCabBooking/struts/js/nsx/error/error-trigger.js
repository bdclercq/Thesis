define(["require","exports","pubsub-js","nsx/error/error-levels"],(function(e,r,n,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.clearHandlers=r.defineHandler=r.defineListener=r.defineTrigger=void 0;var t={"message.info":i.info,"message.warn":i.warn,"message.error":i.error,"message.fatal":i.fatal};function s(e,r){return r?e+"."+r:e}function f(e,r){r=r||{};var i=e.level;return{subscribe:function(e){i.subscribe.forEach((function(i){n.subscribe(s(i,r.filter),(function(r,n){e(n,t[function(e){return e.split(".").slice(0,2).join(".")}(r)],function(e){return e.split(".").slice(2).join(".")}(r))}))}))}}}r.defineTrigger=function(e){function r(r,i){var t=s(r.publish,e.subject);n.publish(t,i)}function t(e){r(i.error,e)}return e=e||{},{warn:function(e){r(i.warn,e)},error:t,errors:function(e){e.forEach(t)},fatal:function(e){r(i.fatal,e)},info:function(e){r(i.info,e)}}},r.defineListener=f;var o=function(){var e;function r(){e={"message.info":[],"message.warn":[],"message.error":[],"message.fatal":[]}}return r(),f({level:i.all}).subscribe((function(r,n,i){for(var t=e[n.publish],s=!1,f=0;!s&&f<t.length;){var o=t[f++];o.filter&&-1===i.indexOf(o.filter)||(s=o.handle(r,n,i))}})),{subscribe:function(r){var n=e[r.key];n.push({handle:r.handle,priority:r.priority,filter:r.filter}),n.sort((function(e,r){return e.priority<r.priority?-1:1}))},reset:r}}();r.defineHandler=function(e,r){r=r||{};var n=e.level,i=e.priority,t=r.filter;return{subscribe:function(e){n.subscribe.forEach((function(r){o.subscribe({key:r,priority:i,handle:e,filter:t})}))}}},r.clearHandlers=function(){o.reset()}}));