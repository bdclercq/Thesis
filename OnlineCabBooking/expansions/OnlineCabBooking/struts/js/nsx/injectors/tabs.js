define(["require","exports","knockout","jquery","nsx/util/utils","nsx/triggers","nsx/injectors/page-segment","nsx/injectors/injector"],(function(e,i,n,r,t,s,o,u){"use strict";function a(e,i){i=i||{};var a=e.selector,d=!t.isDefined(i.visible)||i.visible,b=s.defineBundledTrigger();n.isSubscribable(d)&&b.addTrigger(d);var l,v=1,c=n.observableArray([]),f=n.observable(),p=!1,g=i.parent||o;function m(e){return t.isDefined(f())&&f().name===e.name}function w(e){var i=s.defineTrigger();return i.subscribe((function(){f(e),p=!0,x()})),{label:e.name,showTab:i,visible:e.visible,isSelected:n.pureComputed((function(){return m(e)}))}}function j(e){return{id:e.domain.generateId(),view:e.view,viewModel:e.viewModel,registerTab:function(i){var n=r(i);n.is("div")&&e.injector.completeRendering(n)},isSelected:n.pureComputed((function(){return m(e)}))}}function T(){var e=n.unwrap(f);p&&n.unwrap(e.visible)||function(){var e=c();if(e.length>0)for(var i=0;i<e.length;){var r=e[i];if(n.unwrap(r.visible))return f(r),void x();i++}f()}()}function x(){if(n.utils.unwrapObservable(d)){var e=f();e&&e.injector.reveal()}}return b.subscribe(T),b.subscribe(x),{defineTab:function(e,i){i=i||{};var n,r,s=l.domain.subDomain("tab"+v++),o=new u.Injector({segment:null,domain:s});return i.visible&&i.visible.subscribe&&b.addTrigger(i.visible),n=i.position,r={name:e.name,view:e.view,viewModel:e.viewModel,visible:!t.isDefined(i.visible)||i.visible,domain:s,injector:o},t.isDefined(n)?c.splice(n,0,r):c.push(r),T(),o},rendered:(l=g.definePageSegment({selector:a,view:"nsx/knockout/tabs",viewModel:{tabHeaders:n.pureComputed((function(){return c().map(w)})),tabContents:n.pureComputed((function(){return c().map(j)})),selection:f}},{visible:d,renderOn:i.renderOn})).rendered}}Object.defineProperty(i,"__esModule",{value:!0}),i.defineTabs=void 0,i.defineTabs=a,u.Injector.prototype.defineTabs=function(e,i){return(i=i||{}).parent=this,a(e,i)}}));