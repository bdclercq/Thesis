define(["require","exports","knockout","nsx/nsx-agent","./dropdowns"],(function(e,t,n,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLinkFieldSelect=void 0,t.createLinkFieldSelect=function(e,t){var o=(0,i.createAgent)(t.dataElement),a={0:{id:0,name:""}},c=[0],l=function(e){var t=document.createElement("select");t.style.marginBottom="0";var n=document.createElement("span");return n.classList.add("icon-spinner","rotating-icon"),n.style.display="none",e.append(t,n),{select:t,busyIcon:n}}(e),r="";function d(){var e=l.select.namedItem("__selection");e&&l.select.removeChild(e);var n="".concat(t.value().id);if(r=n,l.select.value=n,""!==n)if(a[n]){if(c.indexOf(t.value().id)<0){var i=a[n],d=(0,s.createOption)(i,i.id,t);d.setAttribute("name","__selection"),l.select.prepend(d)}}else(function(e,t){return new Promise((function(n,i){t.getProjection(e,"info").then((function(e){e.success?n(e.value):i("no value found")}))}))})(t.value(),o).then((function(e){var i=(0,s.createOption)(e,e.id,t);i.setAttribute("name","__selection"),a[n]=e,l.select.prepend(i),l.select.value=n}))}l.select.addEventListener("change",(function(){var n=l.select.value;if(t.dropdown.includeMore&&n===s.MORE_VALUE){var i=new CustomEvent("show-picklist");e.dispatchEvent(i),l.select.value=r}else{r=n;var o=parseInt(n),c=a[o];c&&t.value(c.dataRef)}}));var u=t.value.subscribe(d);n.utils.domNodeDisposal.addDisposeCallback(e,(function(){u.dispose()})),function(e,t,n,i){return t.busyIcon.style.display="initial",i.find({searchMethod:n.dropdown.finder,details:n.dropdown.finderDetails,page:0,rowsPerPage:n.dropdown.maxSize||-1,sortFields:n.dropdown.sortFields}).then((function(e){return t.busyIcon.style.display="none",e}))}(0,l,t,o).then((function(e){e.success&&((0,s.setSelectOptions)({container:l.select,list:e.list,totalNbItems:e.totalNumberOfItems,valueFunction:function(e){return"".concat(e.id)},params:t}),e.list.forEach((function(e){a[e.id]=e,c.push(e.id)})),l.select.value="".concat(t.value().id)),t.value().id&&d()}))}}));