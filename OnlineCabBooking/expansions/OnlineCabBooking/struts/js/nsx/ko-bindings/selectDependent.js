"use strict";define(["knockout","jquery","nsx/nsx-application","nsx/nsx-dropdown","nsx/nsx-find-model","nsx/nsx-list-model","nsx/nsx-dialog","nsx/nsx-utils","nsx/nsx-view-model","nsx/nsx-translation"],(function(n,t,e,i,o,r,a,u,d,l){function c(n,e){var i=t(n),o=i.find("input"),r=e();r?o.val(r.name):o.val(""),n.disabled?function(n){n.find("input").attr("disabled","disabled"),n.find(".searchButton,.dropDownButton,.clearButton").hide()}(i):function(n){n.find("input").removeAttr("disabled"),n.find(".searchButton,.dropDownButton,.clearButton").show()}(i)}return n.bindingHandlers.selectDependent={init:function(s,f,p){var m,x=t(s),v=f(),w=v.field,h=v.driver,g=e.getElement(v.element),D=(m=n.unwrap(h),r.createListModel(b(m)));function b(n,t){if(!n)return r.createEmptyDataModel();var e={};return e[v.finderField]={id:n.id},v.nameField&&(e[v.nameField]=t),o.createDataModel(g,v.finder,e)}function M(n){w(n)}function k(){w(void 0)}function B(){function t(n,t){n.confirm&&n.confirm()&&t()}require(["text!html/nsx/knockout/searchDataRef.html"],(function(e){var i=function(t,e){var i=d.createViewModel(t,{dataModel:b(n.unwrap(h),""),listOptions:{rowsPerPage:5}});return i.confirm=function(){var n=i.listModel.selectedItem();if(n){var o=u.createDataRef(t,n);e(o)}else e(void 0);return!0},i.paging.gotoFirstPage(),i}(g,M),o={title:n.observable(),content:e,contentModel:i,confirm:t,showParent:!0};l.getTranslation(g.getElementName(),(function(n){n=u.firstToUpperCase(n),o.title(n)})),a.showDialog(o)}))}D.updateQuery=function(t){var e=n.unwrap(h);t+="%",v.looseMatch&&(t="%"+t),D.setDataModel(b(e,t))},n.isObservable(h)&&h.subscribe((function(){!function(n,t){t(null),c(n,t)}(s,w),D.updateQuery("")})),require(["text!html/nsx/knockout/selectDropdownSearch.html"],(function(t){x.html(t);var e=x.find("input");c(s,v.field);var o={createListModel:function(n,t){t(D)},control:x,input:e,autoComplete:function(n,t,e){n.updateQuery(t),e()},update:M},r=i.createDropDown(o);x.find(".searchButton").click(B),x.find(".clearButton").click(k),x.find(".dropDownButton").click((function(t){t.stopPropagation(),n.unwrap(h)&&r.toggle()}))}))},update:function(n,t){c(n,t().field)}},{}}));