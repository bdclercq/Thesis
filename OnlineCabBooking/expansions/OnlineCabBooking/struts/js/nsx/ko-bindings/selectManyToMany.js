"use strict";define(["jquery","knockout","nsx/nsx-application","nsx/nsx-find-model","nsx/nsx-list-model","nsx/nsx-dialog","nsx/nsx-view-model","nsx/nsx-translation","nsx/nsx-utils","require"],(function(e,n,t,o,i,r,a,l,s,u){function c(e){var t,o=e()||[],i=n.observableArray();for(t=0;t<o.length;t++)i.push(o[t]);return i}function f(e,n){var t,o=c(e);e.subscribe((function(){o(c(e)())}));var r,a={selectRow:function(e){t.removeItem(e)}};function l(){var e=Math.ceil(o().length/t.getRowsPerPage());t.numberOfPages(e)}return(t=i.createListModel((r=o,{getPage:function(e,n,t){var o=e*n,i=o+n,a=r.slice(o,i);t(Math.ceil(r().length/n),a)}}),a,n)).addItem=function(e){t.containsItem(e)||(o.push(e),l(),t.gotoLastPage())},t.removeItem=function(e){e&&(o.remove((function(n){return n.id===e.id})),l(),t.currentPage()>=t.numberOfPages()?t.gotoLastPage():t.reloadPage())},t.removeAll=function(){o.removeAll()},t.containsItem=function(e){if(!e)return!1;var n,t,i=o();for(n=e.id,t=0;t<i.length;t++)if(i[t].id===n)return!0;return!1},t.updateTarget=function(e){var n,t=o();for(e.removeAll(),n=0;n<t.length;n++)e.push(t[n])},t}function d(n,t){var o=e(n);o.find("input").val(function(e){var n,t,o=e.length;if(o>0){var i=[];for(t=0;t<Math.min(3,o);t++)i.push(e[t].name);o>3&&i.push("..."),n=i.join(", ")}else n="...";return n}(t)),n.disabled?function(e){e.find("input").attr("disabled","disabled"),e.find(".searchButton,.clearButton").hide()}(o):function(e){e.find("input").removeAttr("disabled"),e.find(".searchButton,.clearButton").show()}(o)}n.bindingHandlers.selectManyToMany={init:function(o,i,c,m,g){var v=e(o),h=i(),p=h.field,x={rowsPerPage:5},b=(c(),t.getElement(h.element)),P=f(p,x),I=function(e,n,t){var o=a.createViewModel(e,{listOptions:t});return o.listInteraction.selectRow=function(e){n.containsItem(e)?n.removeItem(e):n.addItem(e)},o.listModel.isItemUsed=function(e){return n.containsItem(e)},o}(b,P,x);function M(){return P.updateTarget(p),!0}function k(){p.removeAll(),P.removeAll()}function w(){var e={title:n.observable("loading ..."),sourceModel:I,targetModel:P,confirm:M};u(["text!html/nsx/knockout/nsx-many-to-many-dialog.html"],(function(n){r.popupDialog(n,e),I.listModel.gotoFirstPage(),P.gotoFirstPage()})),l.getTranslation(b.getElementName(),(function(n){n=s.firstToUpperCase(n),e.title(n)}))}u(["text!html/nsx/knockout/selectSearch.html"],(function(e){v.html(e),v.find(".searchButton").click(w),v.find(".clearButton").click(k),d(o,p())}))},update:function(e,n,t,o,i){d(e,n().field())}}}));