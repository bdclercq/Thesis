"use strict";define(["require","jquery","knockout"],(function(e,t,o){return{createDropDown:function(i){var n,s,c=!1,l=i.input,a=!1,f=!1,r={};function u(e){var t=e.target;l.is(t)||n.has(e.target).length>0||(e.stopPropagation(),r.hide())}function d(e){i.update(e),l&&l.is(":focus")?function(){if(s.hasSelection()){var e=s.items().indexOf(s.selectedItem()),t=n.find("li:nth-child("+(e+1)+")").position();n.find("ul.nsx-dropdown").animate({scrollTop:t.top},100)}}():r.hide()}function h(e){38!==e.keyCode&&40!==e.keyCode&&i.autoComplete&&p()}function p(){if(!a){a=!0;var e=l.val();i.autoComplete(s,e,(function(){a=!1,e!==l.val()&&p()}))}}function m(e){r.show()}function w(){l.on("keyup",m)}function k(e){return Array.isArray(e)&&e.length>0}return r.show=function(){var a;f||(n?(n.show(),t("html").on("click",u),l.on("keyup",h),l.off("keyup",m),c=!0):(f=!0,a=i.dropDownTemplate||"text!html/nsx/knockout/dropDown.html",e([a],(function(e){n=t(e),i.displayField&&function(e,t){e.find("li > a > span").attr("data-bind","text: "+t)}(n,i.displayField),i.control.append(n),function(e){var t=e.offset(),o=e.outerHeight()+t.top,i=t.left;n.css({display:"block","z-index":"3000"}),n.find("ul").css({display:"block","min-width":e.outerWidth()}),n.offset({top:o,left:i})}(i.input),l.on("keydown",(function(e){switch(e.keyCode){case 38:r.show(),k(s.items())&&function(){if(s.hasSelection()){var e=s.items().indexOf(s.selectedItem());e>0&&e<s.items().length?s.selectRow(s.items()[e-1]):s.selectRow(s.items()[s.items().length-1])}else s.selectRow(s.items()[s.items().length-1])}();break;case 40:r.show(),k(s.items())&&function(){if(s.hasSelection()){var e=s.items().indexOf(s.selectedItem());e>=0&&e<s.items().length-1?s.selectRow(s.items()[e+1]):s.selectRow(s.items()[0])}else s.selectRow(s.items()[0])}();break;case 9:r.hide()}}));var c={selectRow:d};i.createListModel(l.val(),(function(e){(s=e).setInteractionModel(c),i.showMore?s.showMore=function(){r.hide(),i.showMore()}:s.showMore=!1,o.applyBindings(s,n.get(0)),s.gotoFirstPage(),r.show()})),f=!1}))))},r.hide=function(){n.hide(),t("html").off("click",u),l.off("keyup",h),w(),c=!1},r.toggle=function(){c?r.hide():r.show()},w(),r}}}));