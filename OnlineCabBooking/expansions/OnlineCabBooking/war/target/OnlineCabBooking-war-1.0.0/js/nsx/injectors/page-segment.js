define(["require","exports","knockout","jquery","nsx/util/utils","nsx/triggers","nsx/injectors/id-generator","nsx/injectors/injector"],(function(e,n,t,r,i,o,a,d){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.definePageSegment=void 0;function l(n,l){var s=function(e){return i.isDefined(e.parent)?e.parent:{segment:r("html"),rendered:o.atOnce()}}(l=l||{}),u=function(e,n){var t;return t=i.isDefined(n.parent)?n.parent.domain.subDomain(e.selector):a.defineDomain({name:e.selector}),new d.Injector({segment:null,domain:t})}(n,l),f=["text!html/nsx/knockout/ko-breakline.html","text!html/"+n.view+".html"];function c(){e(f,(function(e,n,t){!function(e,n,t,r){p(3,{injectInto:e,koWrapper:n,layoutWrapper:r,view:t})}(s.segment,e,n,t)}))}function p(e,o){if(0===e){if(l.failSilent)return;throw"No element found for selector "+n.selector+" on the page"}var a=function(e,n){var t=e.find(n).first(),i=r("<div></div>");return i.attr("id",u.domain.generateId()),t.replaceWith(i),i}(o.injectInto,n.selector);a.length>0?function(e,r){var o=function(e,t){if(e.length<1)throw"No element found for selector "+n.selector+" on the page";e.html(t.koWrapper);var r=e.find(".nsx-wrapper");return i.isNotDefined(t.layoutWrapper)?r:(r.html(t.layoutWrapper),r.find(".nsx-content"))}(e,r).html(r.view);t.applyBindings({viewModel:n.viewModel,isVisible:!i.isDefined(l.visible)||l.visible},e.find(".nsx-wrapper")[0]),u.completeRendering(o)}(a,o):window.setTimeout((function(){p(--e,o)}),100)}return i.isDefined(l.wrapWith)&&f.push("text!html/"+l.wrapWith+".html"),l.renderOn?o.when(l.renderOn).and(s.rendered).thenDo(c):o.when(s.rendered).thenDo(c),u}n.definePageSegment=l,d.Injector.prototype.definePageSegment=function(e,n){return(n=n||{}).parent=this,l(e,n)}}));