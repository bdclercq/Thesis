define(["require","exports","knockout","nsx/nsx-translation","nsx/nsx-detail","nsx/nsx-application","nsx/nsx-utils"],(function(e,n,t,i,r,l,o){"use strict";function d(e,n){var t=document.createElement("button");t.classList.add("btn");var r=document.createElement("span"),l=document.createElement("span");return r.classList.add(e),(0,i.getTranslation)(n,(function(e){l.textContent=e})),t.append(r,l),t}Object.defineProperty(n,"__esModule",{value:!0}),t.bindingHandlers.finderSelector={init:function(e,n){var a=n(),s=function(){},c=function(e){var n=document.createElement("div");n.classList.add("well");var t=document.createElement("select");t.style.width="100%";var i=document.createElement("form");i.classList.add("form-horizontal");var r=document.createElement("div");r.classList.add("controls"),r.style.display="flex",r.style.justifyContent="flex-end";var l=d("icon-remove","ns.showAll"),o=d("icon-search","ns.search");return l.style.marginRight="5px",r.append(l,o),n.append(t,i,r),{panel:n,select:t,finderForm:i,resetButton:l,submitButton:o}}();function u(){var e=t.unwrap(a.finderModel.finderOptions);!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(c.select),e.forEach((function(e){var n=document.createElement("option");n.value=e.name,(0,i.getTranslation)("".concat(a.element,".").concat(e.name),(function(e){n.label=e})),c.select.add(n)}));var n=a.finderModel.searchMethod().name;c.select.value!==n&&(c.select.value=n,f())}function f(){if(c.select.value){var e=(0,l.getElement)(a.element+(0,o.firstToUpperCase)(c.select.value));r.getForm(e,(function(e){var n,i=a.finderModel.searchDetails(),r=e.mapper;if(r.jsToFormModel)n=r.jsToFormModel(t.toJS(i),a.fieldFilter);else{var l=r.jsToViewModel(t.toJS(i));n={detailModel:l,isFieldVisible:a.fieldFilter?a.fieldFilter:function(e){return!0},isFieldEnabled:function(){return!0},editMode:void 0}}s=function(){return r.viewModelToJS(n.detailModel)},c.finderForm.innerHTML=e.template,t.applyBindings(n,c.finderForm.getElementsByTagName("fieldset")[0])}))}}e.append(c.panel),c.select.addEventListener("change",(function(){f()})),a.finderModel.updated.subscribe((function(){c.select.value=a.finderModel.searchMethod().name,f()})),c.resetButton.addEventListener("click",(function(){a.finderModel.resetFinder(),c.select.value=a.finderModel.searchMethod().name})),c.submitButton.addEventListener("click",(function(){a.finderModel.setFinder(function(e,n){var i=t.unwrap(n.finderOptions).filter((function(n){return n.name===e}));if(0===i.length)throw"Cannot find Finder "+e+" in Finder options list";return i[0]}(c.select.value,a.finderModel),s())})),t.isObservable(a.finderModel.finderOptions)&&a.finderModel.finderOptions.subscribe(u),u()}}}));