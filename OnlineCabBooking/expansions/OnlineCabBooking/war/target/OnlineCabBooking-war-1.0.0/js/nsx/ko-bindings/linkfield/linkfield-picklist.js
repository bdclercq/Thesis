define(["require","exports","knockout","nsx/triggers","nsx/util/text-utils","nsx/paging/standard-pagination","nsx/injectors/popup","nsx/list/standard-paged-list","nsx/list/standard-list-view","nsx/finder/finder-model"],(function(i,e,n,t,s,r,d,l,a,o){"use strict";function c(i,e){var t=n.unwrap(e.finderOptions).filter((function(e){return e.name===i}));if(0===t.length)throw"Cannot find Finder "+i+" in Finder options list";return t[0]}Object.defineProperty(e,"__esModule",{value:!0}),e.createLinkFieldPicklist=void 0,e.createLinkFieldPicklist=function(i,e){var f=(0,t.defineTrigger)(),p=(0,t.defineTrigger)();e.picklist.finderOptions?-1===e.picklist.finderOptions.indexOf(e.picklist.finder)&&e.picklist.finderOptions.push(e.picklist.finder):e.picklist.finderOptions=[e.picklist.finder];var u=(0,o.defineFinders)({element:e.dataElement,defaultFinder:e.picklist.finder,defaultDetails:e.picklist.finderDetails,finders:e.picklist.finderOptions||[e.picklist.finder],resetOn:p});!function(i,e,o,c){var f=(0,l.defineListModel)({searchMethod:i.searchMethod,searchDetails:i.searchDetails},{reloadOn:e,pageSize:o.picklist.pageSize,sorting:{sortFields:o.picklist.sortFields}}),p=r.definePagination(f),u=(0,t.defineTrigger)(),g=n.observable(!1);u.subscribe((function(){g(!g())})),p.toggleFinder=u;var k={instanceView:{defineInstanceView:function(i){var e=i.details,n={};return o.picklist.displayFields.forEach((function(i){var t=e[i];n[i]=function(i){return i?"string"==typeof i?i:i.functionalKeyAsString?i.functionalKeyAsString:i.name?i.name:i.value?i.value:"".concat(i):"".concat(i)}(t)})),n}},page:f.page},v=(0,a.defineListView)(k);v.displayFields=o.picklist.displayFields;var h=(0,t.defineTrigger)();h.subscribe((function(){v.hasSelection()&&c(v.selection())})),e.subscribe((function(){return p.pageNb("0")})),(0,t.when)(i.updated).thenDo(f.reloadPage),(0,d.definePopup)({trigger:e,title:(0,s.translate)(o.dataElement.getElementName()),view:"nsx/knockout/linkfield-picklist",viewModel:{element:o.element,showFinders:g,finderModel:i,pagination:p,list:v}},{onConfirm:h})}(u,f,e,(function(i){return e.value(i)})),i.addEventListener("show-picklist",(function(i){if(i.detail){var n=c(i.detail.finder,u);u.setFinder(n,i.detail.finderDetails)}else{n=c(e.picklist.finder,u);u.setFinder(n,e.picklist.finderDetails),p.trigger()}f.trigger()}))}}));