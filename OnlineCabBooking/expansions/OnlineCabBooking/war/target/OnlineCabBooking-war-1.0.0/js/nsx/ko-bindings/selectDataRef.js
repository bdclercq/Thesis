"use strict";define(["jquery","knockout","nsx/nsx-application","nsx/nsx-find-model","nsx/nsx-list-model","nsx/nsx-dialog","nsx/nsx-dropdown","nsx/nsx-utils","nsx/nsx-view-model","nsx/nsx-translation","require"],(function(e,t,n,o,i,a,r,l,u,c,s){function d(n,o){var i=t.utils.unwrapObservable(o),a=i?i.name:"",r=e(n);r.find("input").val(a),n.disabled?function(e){e.find("input").attr("disabled","disabled"),e.find(".searchButton,.dropDownButton,.clearButton").hide()}(r):function(e){e.find("input").removeAttr("disabled"),e.find(".searchButton,.dropDownButton,.clearButton").show()}(r)}function f(n){function i(e,t){e.confirm&&e.confirm()&&t()}s(["text!html/nsx/knockout/searchDataRef.html"],(function(r){var s=function(t){var n=t.element,i={listOptions:{rowsPerPage:5}},a=t.search;if(a.isCustom){var r={};r[a.fieldName]=null,r=e.extend(r,a.parameters),i.dataModel=o.createDataModel(n,a.method,r)}var c=u.createViewModel(n,i);return c.confirm=function(){var e=c.listModel.selectedItem();if(e){var o=l.createDataRef(n,e);t.update(o)}else t.update(void 0);return!0},c.listModel.gotoFirstPage(),c}(n),d={title:t.observable(),content:r,contentModel:s,confirm:i,showParent:!0},f=n.element;c.getTranslation(f.getElementName(),(function(e){e=l.firstToUpperCase(e),d.title(e)})),a.showDialog(d)}))}function m(n){var a=n.control,l=a.find("input");var u={createListModel:function(a,r){r(function(t){var n=t.element,a=t.initialQuery,r=t.selectedItem,l=t.search;function u(t){t+="%";var i={};return i[l.fieldName]=t,i=e.extend(i,l.parameters),o.createDataModel(n,l.method,i)}var c=i.createListModel(u(a));return c.isSelectedItem=function(e){return r&&r.id===e.id},c.updateQuery=function(e){c.setDataModel(u(e))},c}({element:n.element,initialQuery:a,currentValue:t.utils.unwrapObservable(n.observable),search:n.search}))},autoComplete:function(e,t,n){e.updateQuery(t),n()},control:a,input:l,update:n.update,showMore:n.popupDialog},c=r.createDropDown(u);a.find(".dropDownButton").click((function(e){e.stopPropagation(),c.toggle()}))}t.bindingHandlers.selectDataRef={init:function(o,i){var a=i(),r=a.field,l=n.getElement(a.element),u=e(o),c={method:"findByNameEq",parameters:{},fieldName:"name"};function p(e){r(e),d(o,r)}function h(){p(void 0)}function v(){f({element:l,update:p,search:c})}a.search&&((c=e.extend(c,t.toJS(a.search),{isCustom:!0})).allowFinderSelection=!1);var x=!a.hideDropdown,w=function(e){return e?"text!html/nsx/knockout/selectDropdownSearch.html":"text!html/nsx/knockout/selectSearch.html"}(x);s([w],(function(e){u.html(e);var t=u.find("input"),n=u.find(".searchButton"),i=u.find(".clearButton");n.click(v),i.click(h),x&&m({control:u,input:t,update:p,element:l,observable:r,search:c,popupDialog:v}),d(o,r),t.change((function(){var e=t.val();void 0!==e&&""!=e&&0!=e.length||r(void 0)}))}))},update:function(e,t){d(e,t().field)}}}));