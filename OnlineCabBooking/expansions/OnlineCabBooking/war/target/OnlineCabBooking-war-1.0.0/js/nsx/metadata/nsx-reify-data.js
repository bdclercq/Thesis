"use strict";define(["jquery","nsx/nsx-utils","nsx/nsx-agent"],(function(n,e,t){function r(n,e){return n+"."+e.name}function i(e){var t={};return n.each(e,(function(n,e){t[e.name]=e})),t}function u(e,t){var r={};return n.each(e,(function(e,i){r[i.name]=function(e,t){var r=[];return n.each(e.fieldOperators,(function(n,e){var i=e.fieldName,u={fieldName:i,operator:e.operator,field:t[i]};r.push(u)})),{name:e.name,specifications:r}}(i,t)})),r}function o(e,t,r){return f(r,n.map(e,(function(n){var e=t[n];if(!e)throw"Field '"+n+"' does not exist!";return e})),"<derived:"+r.getElementName()+">")}function a(e,t){return n.map(e,(function(e){return function(e,t){var u=e.fields,a=i(u),f=t.getQualifiedName()+"."+e.name;return n.each(u,(function(n,e){e.qualifiedName=r(f,e)})),m(u),{getName:function(){return e.name},getFields:function(){return u},getField:function(n){return a[n]},createProjection:function(e){return o(n.isArray(e)?e:arguments,a,t)}}}(e,t)}))}function f(e,t,r){var i={};return n.each(t,(function(n,e){i[e.name]=e})),{getName:function(){return r},getFields:function(n){return n?function(n,e){for(var t=[],r=0;r<n.length;r++){var i=n[r];e(i)&&t.push(i)}return t}(t,n):t},getField:function(n){return i[n]},getElement:function(){return e},createProjection:function(t){return o(n.isArray(t)?t:arguments,i,e)}}}function c(e,t,r){return n.map(e,(function(e){return function(e,t,r){var i={};return n.each(e.calculatedFields,(function(n,e){e[e.name]=e})),f(t,n.map(e.fieldNames,(function(n){return r[n]||i[n]})),e.name)}(e,t,r)}))}function m(t){n.each(t,(function(n,t){if("link"===t.fieldType){var r=e.firstToLowerCase(t.linkElement);t.qualifiedLink=t.linkComponent+"."+r;var i=t.linkDriver;i&&(t.linkDriver={driverField:i.driverField,finderField:i.finderField,findMethod:i.finder})}}))}return{reifyDataElement:function(e,o){var f=o.getQualifiedName(),l=e.fields,d=i(l),s=null;o&&function(e){n.each(e,(function(n,e){e.element=o,e.qualifiedName=r(f,e)}))}(l),m(l);var g,v=function(e){var t={};return n.each(e,(function(n,e){t[e.getName()]=e})),t}(c(e.projections,o,d)),h=function(e){var t={};return n.each(e,(function(n,e){t[e.getName()]=e})),t}(a(e.commands,o));return{component:e.component,elementName:e.elementName,getElement:function(){return o},getAgent:function(){return g||(g=t.createAgent(o)),g},getProjection:function(n){var e=v[n];if(e)return e;throw"Projection '"+n+"' not found"},getFinder:function(n){return(s||(s=u(e.finders,d)),s)[n]},getFields:function(e){return n.map(e,(function(n){return d[n]}))},getCommand:function(n){return h[n]}}}}}));