"use strict";define((function(e){var n=e("jquery"),a=e("knockout"),t=e("nsx/nsx-application"),r=e("nsx/nsx-view-model"),i=e("../metadata/nsx-metadata"),o=e("nsx/nsx-agent"),s=e("../view/observableInstanceBuilder");return{createFromElement:function(e,l){var g=o.createAgent(e),u=e.getComponentName(),d=t.getElement(u,e.getElementName()+"Lang"),c=o.createAgent(d),m=t.getElement(u,"language"),f=o.createAgent(m);i.mapDataElement(e).then((function(e){var t,i,o=e.getCommand("setTranslation"),u=a.observable(),m=a.observableArray();i=function(e,n){var a=s.createFromFieldProvider(e);return a.disableFields("language"),a.submit=n,a}(o,(function(){var e=i.getData();return g.perform(o.getName(),e,l().id).then((function(e){u(null),t.hasTranslation(!0)})),!1}));var v=function(){var e={},t=[];function r(e){t=e}return e.getPage=function(e,a,r){var i=e*a,o=i+a,s=t.length,l=a>0?Math.ceil(s/a):1;o=Math.min(s,o);var g,u=[];for(g=i;g<o;g++)u.push(t[g]);r(l,u);var d=n.Deferred();return d.resolve({list:u}),d.promise()},e.setLanguagesAndTranslations=function(e,t){var i={};n.each(t,(function(e,n){i[n.language]=n}));var o=[];n.each(e,(function(e,n){var t=i[n.code],r={name:n.name,code:n.code,hasTranslation:a.observable(!!t)};o.push(r)})),r(o)},e}(),h={dataModel:v,listOptions:{rowsPerPage:5}},p=r.createViewModel(d,h);l.subscribe((function(e){var a;e&&n.when((a={details:{},searchMethod:"findAllLanguages",rowsPerPage:-1},f.find(a)),function(e){var n={details:{target:{id:e}},searchMethod:"findByTargetEq",projection:"details",rowsPerPage:-1};return c.find(n)}(e.id)).then((function(e,n){v.setLanguagesAndTranslations(e[0].list,n[0].list),p.gotoFirstPage()}))})),p.selection.subscribe((function(e){var n,a,r,o;t=n=e,l()&&(n?(a=l().id,r=n.code,o={details:{target:{id:a},language:r},searchMethod:"findByTargetEq_LanguageEq"},c.find(o)).then((function(e){var a=e.list;a.length>0?i.update(a[0]):i.update({language:n.code})})):i.update({}))}));var b={visible:a.computed((function(){return!!l()})),command:{command:o,model:i},languages:m,selectedLanguage:u,paging:{hasSelection:u},viewModel:p};a.applyBindings(b,n("#translations")[0])}))}}}));