"use strict";define(["knockout","nsx/metadata/fieldTypes"],(function(e,r){function n(e){$.each(e,(function(r,n){n.meta.linkDriver&&function(r){var n=r.meta.linkDriver;if(r.linkDriver=e[n.driverField],!r.linkDriver)throw"Link driver field 'linkDriver.driverField'"}(n)}))}function i(i){var t=i.fieldProvider,a={},o={};function u(e,r){$.each(e,(function(e,n){var i=o[n];i&&r(i)}))}function c(e){e.enabled(!0)}function l(e){e.enabled(!1)}function s(e){e.visible(!0)}function f(e){e.visible(!1)}function v(e,r){var n=o[e];n&&n.addError(r)}return $.each(t.getFields(),(function(n,t){var a=function(n,i){var t;t=r.isArrayLinkType(n)?e.observableArray():e.observable();var a=r.isBuiltinType(n),o=e.observableArray(),u=e.computed((function(){return o().length>0}));function c(){o.removeAll()}var l={meta:n,name:n.name,value:t,getData:function(){return a?t():{value:t()}},setData:function(e){t(a?e:e&&e.value),c()},errors:o,hasErrors:u,resetErrors:c,addError:function(e){o.push(e)},enabled:e.observable(!0),visible:e.observable(!0)};return a&&r.isLinkType(n)&&(l.selectLink=i.linkSelector),l}(t,i);o[t.name]=a})),n(o),a.fields=o,a.getFields=function(){return o},a.getValue=function(r){var n=a.fields[r].value;return e.isObservable(n)?n():n},a.setValue=function(r,n){var i=a.fields[r];e.isObservable(i.value)?i.value(n):i.value=n},a.update=function(e){$.each(o,(function(r,n){n.setData(e[n.name])}))},a.reset=function(){a.update({})},a.getData=function(){var e={};return $.each(o,(function(r,n){e[n.name]=n.getData()})),e},a.enableFields=function(e){u(arguments,c)},a.disableFields=function(e){u(arguments,l)},a.showFields=function(e){u(arguments,s)},a.hideFields=function(e){u(arguments,f)},a.getFieldProvider=function(){return i.fieldProvider},a.reportErrors=function(e){var r;$.isArray(e)&&(r=e,$.each(r,(function(e,r){v(r.fieldName,r.message)}))),$.isPlainObject(e)&&function(e){$.each(e,(function(e,r){var n=e.split(".").pop();$.each(r,(function(e,r){v(n,r)}))}))}(e)},a.hasErrors=function(){var e;for(e=0;e<o.length;e++)if(o[e].hasErrors())return!0;return!1},a.resetErrors=function(){$.each(o,(function(e,r){r.resetErrors()}))},a}function t(e,r){var n={fieldProvider:e};return i(r=$.extend(n,r))}return{createObservable:i,createObservableFromFields:function(e,r){var n={getFields:function(){return e}};return(r=r||{}).fieldProvider=n,i(r)},createFromProjection:t,createFromCommand:t,createFromFieldProvider:t}}));